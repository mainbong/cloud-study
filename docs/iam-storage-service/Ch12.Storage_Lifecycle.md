# Ch12. Storage Lifecycle & Cost Optimization

## ğŸ“‹ ê°œìš” ë° í•™ìŠµ ëª©í‘œ

### ê°œìš”

**Storage Lifecycle Management**ëŠ” ë°ì´í„°ì˜ ìƒëª…ì£¼ê¸°ì— ë”°ë¼ **ìë™ìœ¼ë¡œ ìŠ¤í† ë¦¬ì§€ í‹°ì–´ë¥¼ ë³€ê²½**í•˜ì—¬ **ë¹„ìš©ì„ ìµœì í™”**í•˜ëŠ” í•µì‹¬ ì „ëµì…ë‹ˆë‹¤. ë°ì´í„°ëŠ” ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ì ‘ê·¼ ë¹ˆë„ê°€ ê°ì†Œí•˜ë©°, **Hot Data** (ìì£¼ ì ‘ê·¼) â†’ **Warm Data** (ê°€ë” ì ‘ê·¼) â†’ **Cold Data** (ê±°ì˜ ì ‘ê·¼ ì•ˆ í•¨) â†’ **Archive** (ì¥ê¸° ë³´ê´€) ë‹¨ê³„ë¥¼ ê±°ì¹©ë‹ˆë‹¤. ê° ë‹¨ê³„ì— ì í•©í•œ ìŠ¤í† ë¦¬ì§€ í‹°ì–´(SSD, HDD, Cloud Archive, Tape)ë¥¼ ì‚¬ìš©í•˜ì—¬ **30-60% ë¹„ìš© ì ˆê°**ì„ ë‹¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2025ë…„ í˜„ì¬, **S3 Lifecycle Policy**, **MinIO Automated Tiering**, **Ceph RGW Storage Class**, **Azure Blob Lifecycle Management** ë“± ì£¼ìš” í”Œë«í¼ì€ **ì •ì±… ê¸°ë°˜ ìë™í™”**ë¥¼ ì œê³µí•©ë‹ˆë‹¤. **Deduplication**(ìµœëŒ€ 90% ìš©ëŸ‰ ì ˆê°), **Compression**(ìµœëŒ€ 87% ì ˆê°), **Intelligent Tiering**(ì ‘ê·¼ íŒ¨í„´ ìë™ ë¶„ì„) ë“± ê³ ê¸‰ ê¸°ëŠ¥ìœ¼ë¡œ íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í•©ë‹ˆë‹¤.

### í•™ìŠµ ëª©í‘œ

ì´ ì±•í„°ë¥¼ ì™„ë£Œí•˜ë©´ ë‹¤ìŒì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **Storage Tier ì´í•´**: Hot, Warm, Cold, Archive í‹°ì–´ì˜ íŠ¹ì„± ë° ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª…
2. **Lifecycle Policy ì‘ì„±**: S3/MinIO/Cephì—ì„œ ìë™ ì „í™˜ ë° ë§Œë£Œ ì •ì±… ì„¤ì •
3. **ë¹„ìš© ìµœì í™”**: Deduplication, Compression, Tieringìœ¼ë¡œ ë¹„ìš© ì ˆê°
4. **ëª¨ë‹ˆí„°ë§**: ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ ë° ë¹„ìš© ì¶”ì , ìµœì í™” ê¸°íšŒ ì‹ë³„
5. **Best Practices ì ìš©**: 2025ë…„ ìŠ¤í† ë¦¬ì§€ ìµœì í™” ëª¨ë²” ì‚¬ë¡€ êµ¬í˜„

---

## ğŸ”‘ í•µì‹¬ ê°œë… ë° ì´ë¡ 

### 1. Storage Tiers

#### 1.1 Tier ë¶„ë¥˜

```mermaid
graph LR
    subgraph "Data Lifecycle"
        Hot[Hot Data<br/>0-30 days<br/>ë†’ì€ ì ‘ê·¼ ë¹ˆë„]
        Warm[Warm Data<br/>30-90 days<br/>ì¤‘ê°„ ì ‘ê·¼ ë¹ˆë„]
        Cold[Cold Data<br/>90-365 days<br/>ë‚®ì€ ì ‘ê·¼ ë¹ˆë„]
        Archive[Archive<br/>>365 days<br/>ê±°ì˜ ì ‘ê·¼ ì•ˆ í•¨]
    end

    subgraph "Storage Media"
        NVMe[NVMe SSD<br/>$0.30/GB/mo]
        SSD[SATA SSD<br/>$0.15/GB/mo]
        HDD[HDD<br/>$0.05/GB/mo]
        CloudArchive[Cloud Archive<br/>$0.004/GB/mo]
        Tape[Tape<br/>$0.001/GB/mo]
    end

    Hot --> NVMe
    Warm --> SSD
    Cold --> HDD
    Archive --> CloudArchive
    Archive --> Tape
```

**Tier íŠ¹ì„±**:

| Tier | ì ‘ê·¼ ë¹ˆë„ | ìŠ¤í† ë¦¬ì§€ | ë ˆì´í„´ì‹œ | ë¹„ìš© (ì˜ˆì‹œ) | ì‚¬ìš© ì‚¬ë¡€ |
|------|----------|----------|----------|-------------|----------|
| **Hot** | ë§¤ì¼ | NVMe SSD | < 1ms | $0.30/GB/mo | DB, í™œì„± VM ë””ìŠ¤í¬ |
| **Warm** | ì£¼ 1-2íšŒ | SATA SSD | < 5ms | $0.15/GB/mo | ìµœê·¼ ë¡œê·¸, ë¶„ì„ ë°ì´í„° |
| **Cold** | ì›” 1íšŒ ì´í•˜ | HDD | 10-50ms | $0.05/GB/mo | ë°±ì—…, ì˜¤ë˜ëœ ë¡œê·¸ |
| **Archive** | ì—° 1íšŒ ì´í•˜ | S3 Glacier / Tape | ë¶„-ì‹œê°„ | $0.001-0.004/GB/mo | ê·œì • ì¤€ìˆ˜, ì¥ê¸° ë³´ê´€ |

#### 1.2 AWS S3 Storage Classes

**S3 Standard â†’ S3 Standard-IA â†’ S3 Glacier â†’ S3 Glacier Deep Archive**:

```mermaid
graph TB
    Standard[S3 Standard<br/>$0.023/GB]
    IA[S3 Standard-IA<br/>$0.0125/GB<br/>30ì¼ ì´ìƒ]
    Glacier[S3 Glacier Flexible<br/>$0.004/GB<br/>90ì¼ ì´ìƒ]
    DeepArchive[S3 Glacier Deep Archive<br/>$0.00099/GB<br/>180ì¼ ì´ìƒ]

    Standard -->|30 days| IA
    IA -->|90 days| Glacier
    Glacier -->|180 days| DeepArchive
```

**ìµœì†Œ ì €ì¥ ê¸°ê°„**:

- **S3 Standard-IA**: 30ì¼ (30ì¼ ë¯¸ë§Œ ì‚­ì œ ì‹œ ì „ì²´ 30ì¼ ë¹„ìš© ë¶€ê³¼)
- **S3 Glacier Flexible**: 90ì¼
- **S3 Glacier Deep Archive**: 180ì¼

**ê²€ìƒ‰ ì‹œê°„**:

- **S3 Standard-IA**: ì¦‰ì‹œ
- **S3 Glacier Flexible**: Expedited (1-5ë¶„), Standard (3-5ì‹œê°„), Bulk (5-12ì‹œê°„)
- **S3 Glacier Deep Archive**: Standard (12ì‹œê°„), Bulk (48ì‹œê°„)

### 2. Lifecycle Policies

#### 2.1 Lifecycle Rule êµ¬ì¡°

```xml
<LifecycleConfiguration>
  <Rule>
    <ID>Move old logs to cold storage</ID>
    <Status>Enabled</Status>
    <Filter>
      <Prefix>logs/</Prefix>
    </Filter>

    <!-- Transition Actions -->
    <Transition>
      <Days>30</Days>
      <StorageClass>STANDARD_IA</StorageClass>
    </Transition>
    <Transition>
      <Days>90</Days>
      <StorageClass>GLACIER</StorageClass>
    </Transition>

    <!-- Expiration Action -->
    <Expiration>
      <Days>365</Days>
    </Expiration>

    <!-- Noncurrent Version Expiration -->
    <NoncurrentVersionExpiration>
      <NoncurrentDays>30</NoncurrentDays>
    </NoncurrentVersionExpiration>
  </Rule>
</LifecycleConfiguration>
```

**Rule êµ¬ì„± ìš”ì†Œ**:

- **Filter**: Prefix ë˜ëŠ” Tag ê¸°ë°˜ í•„í„°ë§
- **Transition**: ë‹¤ë¥¸ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ë¡œ ì´ë™
- **Expiration**: ê°ì²´ ì‚­ì œ
- **NoncurrentVersionExpiration**: ì´ì „ ë²„ì „ ì‚­ì œ (ë²„ì „ ê´€ë¦¬ í™œì„±í™” ì‹œ)

#### 2.2 MinIO Lifecycle (S3 í˜¸í™˜)

MinIOëŠ” **S3 Lifecycle ë¬¸ë²•ê³¼ 100% í˜¸í™˜**ë˜ë©°, ì¶”ê°€ë¡œ **Remote Tiering**ì„ ì§€ì›í•©ë‹ˆë‹¤:

```json
{
  "Rules": [
    {
      "ID": "Transition to S3 after 30 days",
      "Status": "Enabled",
      "Filter": {
        "Prefix": "data/"
      },
      "Transitions": [
        {
          "Days": 30,
          "StorageClass": "S3TIER"
        }
      ]
    }
  ]
}
```

**MinIO Remote Tier ì„¤ì •**:

```bash
# AWS S3ë¥¼ Remote Tierë¡œ ë“±ë¡
mc ilm tier add minio TIER-S3 \
    --endpoint https://s3.amazonaws.com \
    --access-key <AWS_ACCESS_KEY> \
    --secret-key <AWS_SECRET_KEY> \
    --bucket my-archive-bucket \
    --prefix archived/

# MinIO â†’ AWS S3 tiering rule ì¶”ê°€
mc ilm add myminio/data --transition-days 30 --transition-tier TIER-S3
```

#### 2.3 Ceph RGW Storage Classes & Tiering

Ceph **Squid** ë¦´ë¦¬ìŠ¤ë¶€í„° **Storage Class ê¸°ë°˜ Tiering**ì„ ì§€ì›í•©ë‹ˆë‹¤:

```bash
# Storage Class ìƒì„± (Cloud Tier)
radosgw-admin zonegroup placement add \
    --rgw-zonegroup default \
    --placement-id default-placement \
    --storage-class GLACIER \
    --data-pool default.rgw.buckets.glacier

# Lifecycle Policy ì ìš©
aws s3api put-bucket-lifecycle-configuration \
    --bucket my-bucket \
    --lifecycle-configuration file://lifecycle.json \
    --endpoint-url http://ceph-rgw:7480
```

**Ceph Squid 2025 Enhancement**: **Policy-based Data Retrieval** (Tech Preview)

- Cloud/Tape í‹°ì–´ë¡œ ì „í™˜ëœ ê°ì²´ë¥¼ Ceph í´ëŸ¬ìŠ¤í„°ë¡œ ì§ì ‘ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸° ê°€ëŠ¥

### 3. Deduplication & Compression

#### 3.1 Deduplication

**Deduplication**ì€ **ì¤‘ë³µ ë°ì´í„°ë¥¼ ì œê±°**í•˜ì—¬ ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì €ì¥í•©ë‹ˆë‹¤:

```mermaid
graph LR
    subgraph "Before Deduplication"
        File1[File A<br/>1 GB]
        File2[File A Copy<br/>1 GB]
        File3[File A Copy 2<br/>1 GB]
    end

    subgraph "After Deduplication"
        Unique[File A<br/>1 GB]
        Ref1[Reference]
        Ref2[Reference]
    end

    File1 --> Unique
    File2 --> Ref1
    File3 --> Ref2

    Ref1 -.-> Unique
    Ref2 -.-> Unique

    Note1[Total: 3 GB â†’ 1 GB<br/>67% reduction]
```

**íš¨ê³¼**:

- **ë°±ì—…**: 90% ìš©ëŸ‰ ì ˆê° (ë™ì¼ VM ì´ë¯¸ì§€ ë§¤ì¼ ë°±ì—… ì‹œ)
- **VM ìŠ¤í† ë¦¬ì§€**: 50-70% ì ˆê° (ë™ì¼ OS í…œí”Œë¦¿ ì‚¬ìš©)
- **ë¬¸ì„œ**: 30-50% ì ˆê°

**êµ¬í˜„ ë ˆë²¨**:

- **Block-level**: ZFS, Ceph BlueStore (ì¼ë¶€)
- **File-level**: NFS dedup í”ŒëŸ¬ê·¸ì¸
- **Application-level**: Backup software (Veeam, Commvault)

**ì‚¬ë¡€** (2025):

- **Concerto Cloud Services**: 5.4 PB â†’ 203 TB (96% ê°ì†Œ)
- **NTT-Netmagic**: 35% ìš©ëŸ‰ ì ˆê°, Â£240,000/ë…„ ì ˆì•½

#### 3.2 Compression

**Compression**ì€ ë°ì´í„°ë¥¼ ë” íš¨ìœ¨ì ìœ¼ë¡œ ì¸ì½”ë”©í•˜ì—¬ í¬ê¸°ë¥¼ ì¤„ì…ë‹ˆë‹¤:

**ì•Œê³ ë¦¬ì¦˜ ë¹„êµ**:

| ì•Œê³ ë¦¬ì¦˜ | ì••ì¶•ë¥  | CPU ì‚¬ìš©ëŸ‰ | ì†ë„ | ìš©ë„ |
|----------|--------|------------|------|------|
| **LZ4** | ë‚®ìŒ (2-3x) | ë‚®ìŒ | ë§¤ìš° ë¹ ë¦„ | ì‹¤ì‹œê°„ ì••ì¶• (Ceph, MinIO) |
| **Zstd** | ì¤‘ê°„ (3-5x) | ì¤‘ê°„ | ë¹ ë¦„ | ë²”ìš© (Facebook ê°œë°œ) |
| **Gzip** | ì¤‘ê°„ (3-4x) | ì¤‘ê°„ | ë³´í†µ | HTTP, ë¡œê·¸ |
| **Bzip2** | ë†’ìŒ (4-6x) | ë†’ìŒ | ëŠë¦¼ | ì•„ì¹´ì´ë¸Œ |
| **LZMA/XZ** | ë§¤ìš° ë†’ìŒ (6-10x) | ë§¤ìš° ë†’ìŒ | ë§¤ìš° ëŠë¦¼ | ì¥ê¸° ì•„ì¹´ì´ë¸Œ |

**Ceph RGW Compression**:

```bash
# Zone placementì— ì••ì¶• í™œì„±í™”
radosgw-admin zone placement modify \
    --rgw-zone default \
    --placement-id default-placement \
    --compression lz4

# Storage Classë³„ ì••ì¶• ì„¤ì •
radosgw-admin zonegroup placement add \
    --rgw-zonegroup default \
    --placement-id default-placement \
    --storage-class COMPRESSED \
    --compression zstd \
    --data-pool default.rgw.buckets.compressed
```

**MinIO Compression**:

MinIOëŠ” ì„œë²„ ì¸¡ ì••ì¶•ì„ ì§€ì›í•˜ì§€ ì•Šì§€ë§Œ, **í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì••ì¶•** ê¶Œì¥:

```go
// Go SDKì—ì„œ ì—…ë¡œë“œ ì „ ì••ì¶•
import "compress/gzip"

file, _ := os.Open("data.txt")
var buf bytes.Buffer
gw := gzip.NewWriter(&buf)
io.Copy(gw, file)
gw.Close()

minioClient.PutObject(ctx, "bucket", "data.txt.gz", &buf, int64(buf.Len()), minio.PutObjectOptions{
    ContentType: "application/gzip",
})
```

### 4. Cost Optimization Strategies (2025)

#### 4.1 Intelligent Tiering

**AWS S3 Intelligent-Tiering**: ì ‘ê·¼ íŒ¨í„´ì„ ìë™ ë¶„ì„í•˜ì—¬ í‹°ì–´ ì´ë™

```
Frequent Access Tier (ìë™)
    â†“ 30ì¼ ë¯¸ì ‘ê·¼
Infrequent Access Tier (ìë™)
    â†“ 90ì¼ ë¯¸ì ‘ê·¼
Archive Instant Access Tier (ì˜µì…˜, ìë™)
    â†“ 90ì¼ ë¯¸ì ‘ê·¼
Archive Access Tier (ì˜µì…˜, ìë™)
    â†“ 180ì¼ ë¯¸ì ‘ê·¼
Deep Archive Access Tier (ì˜µì…˜, ìë™)
```

**ë¹„ìš©**: $0.0025/1000 ê°ì²´ + ëª¨ë‹ˆí„°ë§ $0.0025/1000 ê°ì²´

**íš¨ê³¼**: ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ì›Œí¬ë¡œë“œì—ì„œ **30-60% ë¹„ìš© ì ˆê°** (ìˆ˜ë™ ê´€ë¦¬ ì—†ì´)

#### 4.2 ë¹„ìš© ì ˆê° Best Practices

**1. Lifecycle ì •ì±… ì ìš©**:

```bash
# ì˜ˆì‹œ: ë¡œê·¸ íŒŒì¼ ìë™ ì •ë¦¬
# - 30ì¼ í›„ Infrequent Access
# - 90ì¼ í›„ Glacier
# - 365ì¼ í›„ ì‚­ì œ
```

**ì ˆê° íš¨ê³¼**: ë¡œê·¸ ìŠ¤í† ë¦¬ì§€ ë¹„ìš© **70-80% ê°ì†Œ**

**2. Versioning + Lifecycle**:

```bash
# í˜„ì¬ ë²„ì „: ìœ ì§€
# ì´ì „ ë²„ì „: 30ì¼ í›„ ì‚­ì œ
```

**ì ˆê° íš¨ê³¼**: ë²„ì „ ê´€ë¦¬ë¡œ ì¸í•œ ì¶”ê°€ ë¹„ìš© **60% ê°ì†Œ**

**3. ì••ì¶• ì ìš© (ë¡œê·¸, ë°±ì—…)**:

```bash
# í…ìŠ¤íŠ¸ ë¡œê·¸: gzip (3-4x ì••ì¶•)
# ë°±ì—…: zstd (3-5x ì••ì¶•)
```

**ì ˆê° íš¨ê³¼**: ìŠ¤í† ë¦¬ì§€ ë¹„ìš© **66-75% ê°ì†Œ**

**4. Deduplication (ë°±ì—…)**:

```bash
# VM ë°±ì—… deduplication
```

**ì ˆê° íš¨ê³¼**: ë°±ì—… ìŠ¤í† ë¦¬ì§€ **80-90% ê°ì†Œ**

**5. ê°ì²´ í¬ê¸° ìµœì í™”**:

- **ì‘ì€ íŒŒì¼ ë³‘í•©**: S3ëŠ” ê°ì²´ë‹¹ ìš”ê¸ˆ ë¶€ê³¼ â†’ ì‘ì€ íŒŒì¼ ìˆ˜ì²œ ê°œë³´ë‹¤ í° íŒŒì¼ í•˜ë‚˜ê°€ ì €ë ´
- **Multipart Upload**: ëŒ€ìš©ëŸ‰ íŒŒì¼ì€ ë©€í‹°íŒŒíŠ¸ë¡œ ì—…ë¡œë“œí•˜ì—¬ ì‹¤íŒ¨ ì‹œ ì¬ì „ì†¡ ìµœì†Œí™”

#### 4.3 ë¹„ìš© ëª¨ë‹ˆí„°ë§

**ë©”íŠ¸ë¦­ ì¶”ì **:

- **Total Storage (GB)**: ì „ì²´ ì‚¬ìš©ëŸ‰
- **Storage by Tier**: Hot/Warm/Coldë³„ ë¶„í¬
- **Monthly Cost**: ì›”ê°„ ë¹„ìš©
- **Cost per GB**: GBë‹¹ ë¹„ìš© (íš¨ìœ¨ì„± ì§€í‘œ)
- **Retrieval Cost**: Cold/Archive í‹°ì–´ì—ì„œ ê°€ì ¸ì˜¤ê¸° ë¹„ìš©

**Prometheus ë©”íŠ¸ë¦­ (ì˜ˆì‹œ)**:

```promql
# ì „ì²´ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰
sum(ceph_pool_bytes_used)

# Poolë³„ ì‚¬ìš©ëŸ‰
ceph_pool_bytes_used{pool="volumes-ssd"}
ceph_pool_bytes_used{pool="volumes-hdd"}

# ë¹„ìš© ì¶”ì • (ê°€ìƒ ë©”íŠ¸ë¦­)
(ceph_pool_bytes_used{pool="volumes-ssd"} / 1024^3) * 0.30  # $0.30/GB/mo
```

---

## ğŸ’» ì‹¤ìŠµ ê°€ì´ë“œ (Hands-on)

### Lab 1: S3/MinIO Lifecycle Policy ì„¤ì •

**ëª©í‘œ**: MinIOì—ì„œ 30ì¼ í›„ ê°ì²´ ì‚­ì œ ì •ì±… ì„¤ì •

**ë‹¨ê³„**:

1. **MinIO ì„¤ì •**:

```bash
# mc alias ì„¤ì •
mc alias set myminio https://minio.example.com ACCESS_KEY SECRET_KEY

# ë²„í‚· ìƒì„±
mc mb myminio/lifecycle-test
```

2. **Lifecycle Policy JSON ì‘ì„±** (`lifecycle.json`):

```json
{
  "Rules": [
    {
      "ID": "Delete old objects",
      "Status": "Enabled",
      "Filter": {
        "Prefix": "temp/"
      },
      "Expiration": {
        "Days": 30
      }
    },
    {
      "ID": "Transition to S3 Glacier",
      "Status": "Enabled",
      "Filter": {
        "Prefix": "archive/"
      },
      "Transitions": [
        {
          "Days": 90,
          "StorageClass": "GLACIER"
        }
      ],
      "Expiration": {
        "Days": 365
      }
    }
  ]
}
```

3. **Policy ì ìš©**:

```bash
# mc ilm ëª…ë ¹ì–´ ì‚¬ìš©
mc ilm import myminio/lifecycle-test < lifecycle.json

# í™•ì¸
mc ilm ls myminio/lifecycle-test
```

4. **í…ŒìŠ¤íŠ¸**:

```bash
# í…ŒìŠ¤íŠ¸ ê°ì²´ ì—…ë¡œë“œ
echo "test" | mc pipe myminio/lifecycle-test/temp/test.txt

# ê°ì²´ í™•ì¸
mc ls myminio/lifecycle-test/temp/

# 30ì¼ í›„ ìë™ ì‚­ì œ (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ëŒ€ê¸° í•„ìš”)
# í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ Daysë¥¼ 1ë¡œ ì„¤ì •í•˜ì—¬ í™•ì¸ ê°€ëŠ¥
```

### Lab 2: Ceph RGW Storage Class & Lifecycle

**ëª©í‘œ**: Ceph RGWì—ì„œ Storage Class ìƒì„± ë° Lifecycle ì •ì±… ì ìš©

**ë‹¨ê³„**:

1. **Storage Class ìƒì„±**:

```bash
# STANDARD_IA Storage Classìš© Pool ìƒì„±
sudo ceph osd pool create default.rgw.buckets.ia 64 replicated
sudo ceph osd pool application enable default.rgw.buckets.ia rgw

# Storage Class ë“±ë¡
sudo radosgw-admin zonegroup placement add \
    --rgw-zonegroup default \
    --placement-id default-placement \
    --storage-class STANDARD_IA \
    --data-pool default.rgw.buckets.ia

# ZoneGroup ì»¤ë°‹
sudo radosgw-admin period update --commit

# RGW ì¬ì‹œì‘
sudo systemctl restart ceph-radosgw@rgw.`hostname -s`
```

2. **Lifecycle Policy ì‘ì„±** (`rgw-lifecycle.json`):

```json
{
  "Rules": [
    {
      "ID": "Move to IA after 30 days",
      "Status": "Enabled",
      "Filter": {
        "Prefix": ""
      },
      "Transitions": [
        {
          "Days": 30,
          "StorageClass": "STANDARD_IA"
        }
      ]
    }
  ]
}
```

3. **Policy ì ìš©** (AWS CLI ì‚¬ìš©):

```bash
# Bucket ìƒì„±
aws s3 mb s3://lifecycle-bucket --endpoint-url http://ceph-rgw:7480

# Lifecycle Policy ì ìš©
aws s3api put-bucket-lifecycle-configuration \
    --bucket lifecycle-bucket \
    --lifecycle-configuration file://rgw-lifecycle.json \
    --endpoint-url http://ceph-rgw:7480

# í™•ì¸
aws s3api get-bucket-lifecycle-configuration \
    --bucket lifecycle-bucket \
    --endpoint-url http://ceph-rgw:7480
```

4. **ê°ì²´ Storage Class í™•ì¸**:

```bash
# ê°ì²´ ì—…ë¡œë“œ
aws s3 cp test.txt s3://lifecycle-bucket/ --endpoint-url http://ceph-rgw:7480

# ê°ì²´ ì •ë³´ í™•ì¸
aws s3api head-object \
    --bucket lifecycle-bucket \
    --key test.txt \
    --endpoint-url http://ceph-rgw:7480 | jq '.StorageClass'

# 30ì¼ í›„ (í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” ìˆ˜ë™ìœ¼ë¡œ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬ê±°)
sudo radosgw-admin lc process
```

### Lab 3: Ceph RGW Compression ì„¤ì •

**ëª©í‘œ**: Storage Classì— ì••ì¶• í™œì„±í™”

**ë‹¨ê³„**:

1. **ì••ì¶• í™œì„±í™”ëœ Storage Class ìƒì„±**:

```bash
# Compressed Pool ìƒì„±
sudo ceph osd pool create default.rgw.buckets.compressed 64 replicated
sudo ceph osd pool application enable default.rgw.buckets.compressed rgw

# Storage Class ë“±ë¡ (lz4 compression)
sudo radosgw-admin zonegroup placement add \
    --rgw-zonegroup default \
    --placement-id default-placement \
    --storage-class COMPRESSED \
    --compression lz4 \
    --data-pool default.rgw.buckets.compressed

# ì»¤ë°‹
sudo radosgw-admin period update --commit
sudo systemctl restart ceph-radosgw@rgw.`hostname -s`
```

2. **ê°ì²´ ì—…ë¡œë“œ (ì••ì¶•ëœ Storage Classë¡œ)**:

```bash
# í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„± (ì••ì¶• ê°€ëŠ¥í•œ í…ìŠ¤íŠ¸)
dd if=/dev/zero of=test-compress.txt bs=1M count=10

# COMPRESSED Storage Classë¡œ ì—…ë¡œë“œ
aws s3 cp test-compress.txt s3://my-bucket/ \
    --storage-class COMPRESSED \
    --endpoint-url http://ceph-rgw:7480

# ê°ì²´ ì •ë³´ í™•ì¸
aws s3api head-object \
    --bucket my-bucket \
    --key test-compress.txt \
    --endpoint-url http://ceph-rgw:7480
```

3. **Cephì—ì„œ ì‹¤ì œ ì••ì¶• í™•ì¸**:

```bash
# ê°ì²´ í¬ê¸° í™•ì¸ (ì••ì¶• ì „)
ls -lh test-compress.txt
# 10M

# Ceph Poolì—ì„œ ì‹¤ì œ ì‚¬ìš©ëŸ‰ í™•ì¸
sudo ceph df detail | grep compressed
# POOL                                 STORED      OBJECTS     USED        %USED
# default.rgw.buckets.compressed       2.5 MiB     1           7.5 MiB     0.00

# ì••ì¶•ë¥  í™•ì¸: 10MB â†’ 2.5MB (75% ì ˆê°)
```

### Lab 4: ë¹„ìš© ë¶„ì„ ë° ìµœì í™”

**ëª©í‘œ**: Prometheus + Grafanaë¡œ ìŠ¤í† ë¦¬ì§€ ë¹„ìš© ì¶”ì  ë° ìµœì í™” ê¸°íšŒ ì‹ë³„

**ë‹¨ê³„**:

1. **ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸** (`storage-cost-exporter.py`):

```python
#!/usr/bin/env python3
import subprocess
import json
from prometheus_client import start_http_server, Gauge
import time

# Prometheus Gauges
storage_bytes = Gauge('storage_bytes', 'Storage usage in bytes', ['pool', 'tier'])
storage_cost_usd = Gauge('storage_cost_usd', 'Estimated monthly cost in USD', ['pool', 'tier'])

# í‹°ì–´ë³„ ë¹„ìš© (USD/GB/month)
TIER_COSTS = {
    'ssd': 0.15,
    'hdd': 0.05,
    'archive': 0.004,
}

def collect_ceph_metrics():
    # ceph df ì‹¤í–‰
    result = subprocess.run(['ceph', 'df', '-f', 'json'], capture_output=True, text=True)
    data = json.loads(result.stdout)

    for pool in data['pools']:
        pool_name = pool['name']
        bytes_used = pool['stats']['bytes_used']

        # Pool ì´ë¦„ì—ì„œ tier ì¶”ì¶œ
        if 'ssd' in pool_name:
            tier = 'ssd'
        elif 'hdd' in pool_name or 'volumes' in pool_name:
            tier = 'hdd'
        elif 'archive' in pool_name:
            tier = 'archive'
        else:
            tier = 'hdd'  # default

        # ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
        storage_bytes.labels(pool=pool_name, tier=tier).set(bytes_used)

        # ë¹„ìš© ê³„ì‚° (bytes â†’ GB)
        gb_used = bytes_used / (1024 ** 3)
        cost = gb_used * TIER_COSTS[tier]
        storage_cost_usd.labels(pool=pool_name, tier=tier).set(cost)

if __name__ == '__main__':
    start_http_server(9999)
    while True:
        collect_ceph_metrics()
        time.sleep(60)  # 1ë¶„ë§ˆë‹¤ ìˆ˜ì§‘
```

2. **Prometheus ìŠ¤í¬ë© ì„¤ì •** (`prometheus.yml`):

```yaml
scrape_configs:
  - job_name: 'storage-cost'
    static_configs:
      - targets: ['localhost:9999']
```

3. **Grafana ëŒ€ì‹œë³´ë“œ ì¿¼ë¦¬**:

```promql
# ì „ì²´ ì›”ê°„ ë¹„ìš©
sum(storage_cost_usd)

# Tierë³„ ë¹„ìš©
sum by (tier) (storage_cost_usd)

# GBë‹¹ ë¹„ìš© (íš¨ìœ¨ì„±)
sum(storage_cost_usd) / (sum(storage_bytes) / 1024^3)

# ìµœì í™” ê°€ëŠ¥ ìš©ëŸ‰ (30ì¼ ë¯¸ì ‘ê·¼ ë°ì´í„°ë¥¼ HDDë¡œ ì´ë™ ì‹œ)
(storage_bytes{tier="ssd"} * 0.3) * (0.15 - 0.05) / (1024^3)
# 30%ê°€ 30ì¼ ë¯¸ì ‘ê·¼ ë°ì´í„°ë¼ê³  ê°€ì •, SSDâ†’HDD ì´ë™ ì‹œ ì ˆê°ì•¡
```

4. **ë¶„ì„ ë° ìµœì í™”**:

```bash
# ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©ëŸ‰ ìš”ì•½
sudo ceph df

# Poolë³„ ë¹„ìš© ë¶„ì„
# - SSD Poolì´ ì „ì²´ ë¹„ìš©ì˜ 70%ë¥¼ ì°¨ì§€í•˜ëŠ”ì§€?
# - HDD Poolë¡œ ì´ë™ ê°€ëŠ¥í•œ ë°ì´í„°ëŠ”?

# Lifecycle Policy ì ìš© (Lab 1, 2 ì°¸ì¡°)
# - SSD â†’ HDD: 30ì¼ í›„
# - HDD â†’ Archive: 90ì¼ í›„
```

### Lab 5: ìë™í™”ëœ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

**ëª©í‘œ**: Go ìŠ¤í¬ë¦½íŠ¸ë¡œ S3 ê°ì²´ì˜ ì ‘ê·¼ ì‹œê°„ì„ ë¶„ì„í•˜ì—¬ ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜

**ì½”ë“œ** (`auto-tiering.go`):

```go
package main

import (
    "context"
    "fmt"
    "log"
    "os"
    "time"

    "github.com/minio/minio-go/v7"
    "github.com/minio/minio-go/v7/pkg/credentials"
)

func main() {
    minioClient, err := minio.New(os.Getenv("MINIO_ENDPOINT"), &minio.Options{
        Creds:  credentials.NewStaticV4(os.Getenv("MINIO_ACCESS_KEY"), os.Getenv("MINIO_SECRET_KEY"), ""),
        Secure: true,
    })
    if err != nil {
        log.Fatal(err)
    }

    ctx := context.Background()
    bucketName := "my-bucket"

    // ëª¨ë“  ê°ì²´ ì¡°íšŒ
    objectCh := minioClient.ListObjects(ctx, bucketName, minio.ListObjectsOptions{
        Recursive: true,
    })

    now := time.Now()
    transitionThreshold := 30 * 24 * time.Hour  // 30ì¼

    for object := range objectCh {
        if object.Err != nil {
            log.Println(object.Err)
            continue
        }

        // LastModified ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë˜ëœ ê°ì²´ í™•ì¸
        age := now.Sub(object.LastModified)

        if age > transitionThreshold {
            fmt.Printf("ê°ì²´ %sëŠ” %dì¼ ì „ì— ìˆ˜ì •ë¨, Storage Class ë³€ê²½ í•„ìš”\n",
                object.Key, int(age.Hours()/24))

            // MinIOì—ì„œëŠ” Storage Classë¥¼ ì§ì ‘ ë³€ê²½í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ
            // Lifecycle Policyë¥¼ ê¶Œì¥
            // ë˜ëŠ” ê°ì²´ë¥¼ ë‹¤ìš´ë¡œë“œ í›„ ë‹¤ë¥¸ í‹°ì–´ë¡œ ì¬ì—…ë¡œë“œ

            // ì˜ˆì‹œ: ê°ì²´ ë³µì‚¬ (ê°™ì€ ë²„í‚·, ë‹¤ë¥¸ Storage Class)
            // ì‹¤ì œë¡œëŠ” mc ilm ì‚¬ìš© ê¶Œì¥
            /*
            src := minio.CopySrcOptions{
                Bucket: bucketName,
                Object: object.Key,
            }
            dst := minio.CopyDestOptions{
                Bucket:       bucketName,
                Object:       object.Key,
                StorageClass: "GLACIER",
            }
            _, err := minioClient.CopyObject(ctx, dst, src)
            if err != nil {
                log.Println(err)
            }
            */
        }
    }

    fmt.Println("\nê¶Œì¥ ì‚¬í•­: mc ilmì„ ì‚¬ìš©í•˜ì—¬ Lifecycle Policy ì„¤ì •")
    fmt.Println("mc ilm add myminio/my-bucket --transition-days 30 --transition-tier GLACIER")
}
```

**ì‹¤í–‰**:

```bash
export MINIO_ENDPOINT="minio.example.com:9000"
export MINIO_ACCESS_KEY="minioadmin"
export MINIO_SECRET_KEY="minioadmin"

go run auto-tiering.go
```

**ì¶œë ¥ ì˜ˆì‹œ**:

```
ê°ì²´ old-data/file1.txtëŠ” 45ì¼ ì „ì— ìˆ˜ì •ë¨, Storage Class ë³€ê²½ í•„ìš”
ê°ì²´ old-data/file2.txtëŠ” 60ì¼ ì „ì— ìˆ˜ì •ë¨, Storage Class ë³€ê²½ í•„ìš”

ê¶Œì¥ ì‚¬í•­: mc ilmì„ ì‚¬ìš©í•˜ì—¬ Lifecycle Policy ì„¤ì •
mc ilm add myminio/my-bucket --transition-days 30 --transition-tier GLACIER
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ê³µì‹ ë¬¸ì„œ

- **MinIO Data Lifecycle Management**: [https://min.io/product/automated-data-tiering-lifecycle-management](https://min.io/product/automated-data-tiering-lifecycle-management)
- **MinIO Object Lifecycle Management**: [https://docs.min.io/enterprise/aistor-object-store/administration/object-lifecycle-management/](https://docs.min.io/enterprise/aistor-object-store/administration/object-lifecycle-management/)
- **MinIO Automatic Object Expiration**: [https://min.io/docs/minio/linux/administration/object-management/create-lifecycle-management-expiration-rule.html](https://min.io/docs/minio/linux/administration/object-management/create-lifecycle-management-expiration-rule.html)
- **MinIO Transition to S3**: [https://min.io/docs/minio/windows/administration/object-management/transition-objects-to-s3.html](https://min.io/docs/minio/windows/administration/object-management/transition-objects-to-s3.html)

### AWS S3 ë¬¸ì„œ

- **AWS S3 Lifecycle Examples**: [https://docs.aws.amazon.com/AmazonS3/latest/userguide/lifecycle-configuration-examples.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/lifecycle-configuration-examples.html)
- **AWS S3 Lifecycle Management**: [https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html)

### Azure ë¬¸ì„œ

- **Azure Blob Lifecycle Management**: [https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-overview](https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-overview)

### Ceph ë¬¸ì„œ

- **Red Hat Ceph RGW Administration**: [https://docs.redhat.com/en/documentation/red_hat_ceph_storage/5/html/object_gateway_guide/administration](https://docs.redhat.com/en/documentation/red_hat_ceph_storage/5/html/object_gateway_guide/administration)
- **Ceph RGW Tiering Enhancements Part 1 (2025)**: [https://ceph.io/en/news/blog/2025/rgw-tiering-enhancements-part1/](https://ceph.io/en/news/blog/2025/rgw-tiering-enhancements-part1/)
- **Ceph RGW Tiering Enhancements Part 2 (2025)**: [https://ceph.io/en/news/blog/2025/rgw-tiering-enhancements-part2/](https://ceph.io/en/news/blog/2025/rgw-tiering-enhancements-part2/)
- **45Drives Intelligent Tiering with Ceph S3**: [https://knowledgebase.45drives.com/kb/kb450472-intelligent-tiering-with-lifecycle-management-on-ceph-s3/](https://knowledgebase.45drives.com/kb/kb450472-intelligent-tiering-with-lifecycle-management-on-ceph-s3/)
- **Implementing Ceph as S3 Object Store (PDF)**: [https://resinfo.org/IMG/pdf/gtceph-20240523-ceph-implementing-s3.pdf](https://resinfo.org/IMG/pdf/gtceph-20240523-ceph-implementing-s3.pdf)

### ì‚°ì—… ìë£Œ

- **Elasticsearch Data Tiers**: [https://www.elastic.co/docs/manage-data/lifecycle/data-tiers](https://www.elastic.co/docs/manage-data/lifecycle/data-tiers)
- **Aerospike Tiered Storage Guide**: [https://aerospike.com/blog/tiered-storage-guide/](https://aerospike.com/blog/tiered-storage-guide/)
- **DataCore Auto Tiering**: [https://www.datacore.com/products/sansymphony/auto-tiering/](https://www.datacore.com/products/sansymphony/auto-tiering/)
- **Wasabi Cloud Tiering**: [https://wasabi.com/learn/what-is-cloud-tiering](https://wasabi.com/learn/what-is-cloud-tiering)
- **Supermicro Cold Data Storage**: [https://www.supermicro.com/en/glossary/cold-data-storage](https://www.supermicro.com/en/glossary/cold-data-storage)
- **Platform3 Storage Tiering Benefits**: [https://platform3solutions.com/blog/storage-tiering-and-its-benefits-for-applications/](https://platform3solutions.com/blog/storage-tiering-and-its-benefits-for-applications/)
- **Open-E Caching vs Auto-tiering**: [https://www.open-e.com/blog/caching-vs-auto-tiering-two-ways-to-accelerate-data-storage/](https://www.open-e.com/blog/caching-vs-auto-tiering-two-ways-to-accelerate-data-storage/)

### ë¹„ìš© ìµœì í™” ê°€ì´ë“œ

- **Deduplication and Compression Case Studies**: [https://hokstadconsulting.com/blog/deduplication-and-compression-cost-saving-case-studies](https://hokstadconsulting.com/blog/deduplication-and-compression-cost-saving-case-studies)
- **DigitalOcean Data Storage Strategies**: [https://www.digitalocean.com/resources/articles/data-storage-management-strategies](https://www.digitalocean.com/resources/articles/data-storage-management-strategies)
- **Cloud Cost Optimization 2025 (Bacancy)**: [https://www.bacancytechnology.com/blog/cloud-storage-cost-optimization](https://www.bacancytechnology.com/blog/cloud-storage-cost-optimization)
- **Cloud Cost Optimization 2025 (Group107)**: [https://group107.com/blog/cloud-cost-optimization-strategies/](https://group107.com/blog/cloud-cost-optimization-strategies/)
- **Cloud Cost Optimization 2025 (Scalr)**: [https://scalr.com/learning-center/cloud-cost-optimization-best-practices-for-2025-a-comprehensive-guide/](https://scalr.com/learning-center/cloud-cost-optimization-best-practices-for-2025-a-comprehensive-guide/)
- **Relief From Data Storage Costs**: [https://cloudtweaks.com/2025/02/relief-from-data-storage-costs/](https://cloudtweaks.com/2025/02/relief-from-data-storage-costs/)

### í•™ìˆ  ìë£Œ

- **Cloud Storage Tier Optimization (Springer)**: [https://link.springer.com/article/10.1007/s00607-024-01281-2](https://link.springer.com/article/10.1007/s00607-024-01281-2)
- **ACM Cost Optimization Survey**: [https://dl.acm.org/doi/10.1145/3582883](https://dl.acm.org/doi/10.1145/3582883)

### í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

ì™„ë£Œí•œ í•­ëª©ì— ì²´í¬í•˜ì„¸ìš”:

- [ ] Hot, Warm, Cold, Archive í‹°ì–´ì˜ íŠ¹ì„±ê³¼ ë¹„ìš© ì°¨ì´ë¥¼ ì´í•´í–ˆë‹¤
- [ ] S3/MinIO/Cephì—ì„œ Lifecycle Policyë¥¼ ì‘ì„±í•˜ê³  ì ìš©í•  ìˆ˜ ìˆë‹¤
- [ ] Transitionê³¼ Expiration ì•¡ì…˜ì˜ ì°¨ì´ë¥¼ ì´í•´í–ˆë‹¤
- [ ] Deduplicationê³¼ Compressionì˜ íš¨ê³¼ ë° ì ìš© ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] ì••ì¶• ì•Œê³ ë¦¬ì¦˜(LZ4, Zstd, Gzip)ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„ë¥¼ ì´í•´í–ˆë‹¤
- [ ] Ceph RGWì—ì„œ Storage Classë¥¼ ìƒì„±í•˜ê³  ì••ì¶•ì„ í™œì„±í™”í•  ìˆ˜ ìˆë‹¤
- [ ] AWS S3 Intelligent-Tieringì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í–ˆë‹¤
- [ ] ìŠ¤í† ë¦¬ì§€ ë¹„ìš© ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­ì„ ì„¤ì •í•˜ê³  ë¶„ì„í•  ìˆ˜ ìˆë‹¤
- [ ] 30-60% ë¹„ìš© ì ˆê°ì„ ìœ„í•œ êµ¬ì²´ì ì¸ ìµœì í™” ì „ëµì„ ìˆ˜ë¦½í•  ìˆ˜ ìˆë‹¤
- [ ] ì‹¤ì œ ì‚¬ë¡€(Concerto Cloud, NTT-Netmagic)ì—ì„œ ì–»ì€ êµí›ˆì„ ì ìš©í•  ìˆ˜ ìˆë‹¤

---

**ì´ ì±•í„°ë¡œ IAM/Storage ì„œë¹„ìŠ¤ ìŠ¤í„°ë”” ê°€ì´ë“œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!** 12ê°œ ì±•í„°ë¥¼ í†µí•´ IAM(Keystone, OAuth/OIDC, RBAC/ABAC, OPA, Vault, Service Mesh)ê³¼ Storage(Swift, S3/MinIO, Ceph, Cinder, Lifecycle) ê¸°ìˆ  ìŠ¤íƒì„ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤. ğŸ‰

**ë‹¤ìŒ ë‹¨ê³„**:
- ê° ì±•í„°ì˜ ì‹¤ìŠµ ê°€ì´ë“œë¥¼ ì§ì ‘ ìˆ˜í–‰í•˜ì—¬ ì‹¤ë¬´ ê²½í—˜ ìŒ“ê¸°
- KakaoCloud IAM/Storage ì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ì„¤ê³„ ë° êµ¬í˜„ í”„ë¡œì íŠ¸ ì§„í–‰
- í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ì™„ë£Œí•˜ì—¬ ì—­ëŸ‰ ê²€ì¦
